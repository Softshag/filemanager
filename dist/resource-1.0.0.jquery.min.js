!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):t.Resource=e(t.$)}(this,function($){var Resource={};Resource.$=$;var Inherits=function(t,e){function n(){this.constructor=t}for(var i in e)Utils.has(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},Ajax=function(){var t;if(null!=window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("msxml2.xmlhttp.6.0")}catch(e){t=e}try{return new ActiveXObject("msxml2.xmlhttp.3.0")}catch(e){t=e}try{return new ActiveXObject("msxml2.xmlhttp")}catch(e){t=e}},toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,__slice=Array.prototype.slice,Utils={extend:function(){var t,e,n,i,s,o;for(e=arguments[0],n=2<=arguments.length?__slice.call(arguments,1):[],s=0,o=n.length;o>s;s++)if(t=n[s],null!==t)for(i in t)e[i]=t[i];return e},isFunction:function(t){return"function"==typeof t},isObject:function(t){return t==Object(t)},isString:function(t){return"[object String]"===toString.call(t)},isArray:function(t){return"[object Array]"===toString.call(t)},isElement:function(t){return!!t&&1===t.nodeType},result:function(t,e){return Utils.isFunction(t[e])?t[e]():t[e]},pick:function(t,e){for(var n,i={},s=0;s<e.length;s++)n=e[s],Utils.has(t,n)&&(i[n]=t[n]);return i},map:function(t,e){var n=[];return this.each(t,function(t){n.push(e(t))}),n},has:function(t,e){return null!=t&&hasOwnProperty.call(t,e)},each:function(t,e){var n,i=t.length;if(i===+i)for(n=0;i>n;n++)e(t[n],n,t);else{var s=Object.keys(t);for(n=0,i=s.length;i>n;n++)e(t[s[n]],s[n],t)}return t},bind:function(){var t,e,n,i,s;if(i=arguments[0],s=arguments[1],t=3<=arguments.length?__slice.call(arguments,2):[],!this.isFunction(i))throw new TypeError("Function.prototype.bind - what is tying to be bound is not callable");return n=function(){},e=function(){var e;return e=this instanceof n&&s?this:s,i.apply(e,t.concat(Array.prototype.slice.call(arguments)))}}};Resource.Events={on:function(t,e,n){return this.addEventListener(t,e,n,!1)},once:function(t,e,n){return this.addEventListener(t,e,n,!0)},addEventListener:function(t,e,n,i){return i=i||!1,null==this._events&&(this._events={}),null==this._events[t]&&(this._events[t]=[]),this._events[t].push({fn:e,once:i,context:n||this}),this},off:function(t,e){if(null==this._events)return this;if(t){if(t&&!e)this._events[t]=[];else if(t&&e&&null!=this._events[t])for(var n=this._events[t],i=0;i<n.length;i++){var s=n[i];s.fn==e&&this._events[t].splice(i,1)}}else this._events={}},trigger:function(){var t,e;if(e=arguments[0],t=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],null==this._events)return this._events={},this._events[e]=[],this;for(var n=this._events[e]||[],i=0;i<n.length;i++){var s=n[i];s.fn.apply(s.context,t),s.once&&this._events[e].splice(i,1)}return this}};var detailsTemplate=function anonymous(obj){obj||(obj={});var p=[];with(obj)p.push('<div class="fm-resource-details-container">\n  <div class="fm-resource-details-thumbnail-container">\n    <img />\n  </div>\n  <div class="fm-resource-details-info-container">\n    <h5>',path,"</h5>\n    <span><small>size:</small>",size," kb</span>\n    <span><small>type:</small>",mime,"</span>\n  </div>\n</div>\n");return p.join("")},listitemTemplate=function anonymous(obj){obj||(obj={});var p=[];with(obj)p.push('<div>\n  <div class="fm-resource-item-thumbnail">\n    <img />\n  </div>\n\n\n  <span>',path,"</span>\n</div>\n");return p.join("")},listTemplate=function anonymous(obj){obj||(obj={});var p=[];with(obj)p.push('<div class="fm-resource-list-container">\n  <div class="fm-resource-list-toolbar">\n    <button type="button" class="fm-toolbar-btn list-btn">List</button>\n    <button type="button" class="fm-toolbar-btn collection-btn">Collection</button>\n  </div>\n  <div class="fm-resource-list-container-inner">\n    <ul class="fm-resource-list">\n  </div>\n\n  </ul>\n</div>\n');return p.join("")},viewTemplate=function anonymous(obj){obj||(obj={});var p=[];with(obj)p.push('<div class="fm-container">\n  <div class="fm-container-inner">\n    <div class="fm-list-container">\n\n    </div>\n    <div class="fm-details-container">\n    </div>\n  </div>\n  <div class="fm-button-bar">\n    <button type="button" class="remove-btn">Remove</button>\n    <button type="button">Add</button>\n  </div>\n</div>\n');return p.join("")},FileUpload=function(){function t(t){this.options=t||{}}function e(t){var e=null;try{e=JSON.parse(t)}catch(n){e=t}return e}function n(t){if("function"==typeof this.options.maxSize){if(!this.options.maxSize(t))return new Error("file too big")}else if(t.size>this.options.maxSize)return new Error("File too big");var e=t.type,n=this.options.mimeType;if(n){if("function"==typeof n)return n(t);Array.isArray(n)||(n=[n]);for(var i=null,s=0;s<n.length;s++){if(mime=new RegExp(n[s].replace("*",".*")),mime.test(e))return null;i=new Error("Wrong mime type")}return i}}return Utils.extend(t.prototype,Resource.Events),t.prototype.upload=function(t,i,s){var o=this,r=new FormData,l=n.call(this,t);if(l)return void this.trigger("error",t,l);r.append(this.options.param,t),i=i||{},Object.keys(i).forEach(function(t){var e=i[t];r.append(t,e)});var a=Ajax();return a.open(this.options.method,this.options.url),a.onerror=function(){var n={code:a.status,message:e(a.responseText)};o.trigger("error",t,n)},a.onreadystatechange=function(){if(4==a.readyState){var n=e(a.responseText);200==a.status||201==a.status?(s&&s(null,n),o.trigger("complete",t,n)):(s&&s(n,null),o.trigger("error",t,n))}},a.upload.onprogress=function(e){if(e.lengthComputable){var n=e.loaded/e.total*100||0;o.trigger("progress",t,n)}},a.send(r),this},t.defaults={maxSize:1024,mimeType:null,param:"file"},t}(),UploadButton=function(){function t(t,s){this.options=s||{},this._executing=!1,this.files=[],this.el=t,this.options=s,this._upload=new FileUpload(s),this._upload.on("complete",_.bind(n,this)),this._upload.on("progress",_.bind(i,this)),this._upload.on("error",_.bind(e,this));var o=this;t.addEventListener("change",function(){o.files=[];for(var e=0;e<t.files.length;e++)o.files.push(t.files[e]);o.upload()})}function e(t,e){this.trigger("error",t,e)}function n(t,e){this.trigger("complete",t,e)}function i(t,e){this.trigger("progress",t,e)}Utils.extend(t.prototype,Resource.Events),t.prototype.upload=function(){var t=this;this._executing=!0,s(this.files,function(e,n){t._upload.upload(e,{},n)},function(){})},t.prototype.dispose=function(){this._upload.off(),this.el.removeEventListener("change"),self._upload=null};var s=function(t,e,n){if(!Array.isArray(t))throw new TypeError("each() expects array as first argument");if("function"!=typeof e)throw new TypeError("each() expects function as second argument");if("function"!=typeof n&&(n=Function.prototype),0===t.length)return n(void 0,t);var i=new Array(t.length),s=0,o=!1;t.forEach(function(r,l){e(r,function(e,r){return o?void 0:e?(o=!0,n(e)):(i[l]=r,s+=1,s===t.length?n(void 0,i):void 0)})})};return t}(),Model=function(){function t(t){this.attributes=t}return Utils.extend(t.prototype,Resource.Events),Utils.extend(t.prototype,{toJSON:function(){return this.attributes}}),t}(),Collection=function(){function t(t){this.options=t||{},this.models=[]}function e(t){var e=null;try{e=JSON.parse(t)}catch(n){e=t}return e}Utils.extend(t.prototype,Resource.Events),Utils.extend(t.prototype,{fetch:function(t){var e=this,i=Utils.result(this,"url");n.call(this,"GET",i,null,function(n,i){return n?(e.trigger("error",n),void(t&&t(n))):(e.models=Utils.map(i,function(t){return new e.model(t)}),t&&t(n,i),e.trigger("fetch",this,i),void e.trigger("change",this,i))})},remove:function(){this.trigger("remove",this,model)},add:function(){}});var n=function(t,n,i,s){var o=Ajax();o.open(t,n),o.onreadystatechange=function(){if(4==o.readyState){var t=e(o.responseText);200==o.status||201==o.status?s&&s(null,t):(s&&s(t,null),self.trigger("error",file,t))}},o.onerror=function(){},o.send(i)};return t}(),MediaCollection=function(t){function e(e){e=e||{},this.model=Model,Utils.extend(this,Utils.pick(e,["url"])),t.prototype.constructor.call(this)}return Inherits(e,t),e}(Collection),BaseView=function(){function t(t){t=t||{},this.tagName=t.tagName||this.tagName||"div",this.className=t.className||this.className,this.setElement(),this.model=t.model||null,this.collection=t.collection||null,this.events=this.events||{};var e=this,n={};Utils.each(this.events,function(t,i){Utils.isString(t)&&(t=e[t]),n[i]=Utils.bind(t,e)}),this.events=n,this.delegateEvents()}return Utils.extend(t.prototype,Resource.Events),Utils.extend(t.prototype,{setElement:function(){this.el=document.createElement(this.tagName),this.$el=Resource.$(this.el),this.className&&this.$el.addClass(this.className)},render:function(){return this.delegateEvents(),this},remove:function(){this.undelegateEvents(),this.el.parentNode.removeChild(this.el),this.collection&&this.collection.off(),this.model},undelegateEvents:function(){var t=this;Utils.each(this.events,function(e,n){if(split=n.split(" "),1===split.length)t.$el.off(split[0],e);else{var i=split[0],s=split[1];t.$(s).off(i,e)}})},delegateEvents:function(){var t=this;this.undelegateEvents(),Utils.each(this.events,function(e,n){split=n.split(" ");var i=split[0];if(1===split.length)t.$el.on(i,e);else{var s=split[1];t.$(s).on(i,e)}})},$:function(t){return this.$el.find(t)}}),t}(),ListItemView=function(t){function e(e){this.tagName="li",t.prototype.constructor.call(this,e),this.template=listitemTemplate}return Inherits(e,t),Utils.extend(e.prototype,{events:{click:function(){this.trigger("select",this)}},render:function(){return console.log(this.model),this.$el.html(this.template(this.model.toJSON())),this.delegateEvents(),this},remove:function(){t.prototype.remove.call(this)}}),e}(BaseView),ListView=function(t){function e(n){n=n||{},t.prototype.constructor.call(this,n),this.options=Utils.extend({},n,e.defaults),this.onStyleButton=Utils.bind(this.onStyleButton,this),this.template=this.options.template||listTemplate;this._items=[],this.bindEvents()}return Inherits(e,t),e.prototype.render=function(){return this.$el.html(this.template()),this._listView=this.$(".fm-resource-list"),this.delegateEvents(),this._listView.addClass(this.options.style+"-style"),this},e.prototype.onStyleButton=function(t){var e=Resource.$(t.target);e.hasClass("collection-btn")?this._listView.removeClass("list-style").addClass("collection-style"):this._listView.removeClass("collection-style").addClass("list-style")},e.prototype.renderItems=function(){Utils.each(this._items,function(t){t.remove()}),this._items=[];var t=this,e=document.createDocumentFragment();Utils.each(this.collection.models,function(n){var i=t.renderItem(n);e.appendChild(i.render().el)}),this._listView.append(e)},e.prototype.renderItem=function(t){var e=new ListItemView({model:t,className:"fm-resource-item id-"+t.id}),n=this;return e.on("select",function(t){Utils.each(n._items,function(t){t.$el.removeClass("selected")}),t.$el.addClass("selected"),n.trigger("select",t.model),n.selected=t}),n._items.push(e),e},e.prototype.events={"click .collection-btn":"onStyleButton","click .list-btn":"onStyleButton"},e.prototype.bindEvents=function(){this.collection.off();var t=this;this.collection.on("change",function(){t.renderItems.call(t)}),this.collection.on("add",function(e){var n=t.renderItem(e);t._listView.append(n.render().el)}),this.collection.on("remove",function(e){for(var n=null,i=0;i<t._items.length&&(n=t._items[i],n.model!=e);i++)n=null;n&&(Utils.addClass(n.el,"deleting"),setTimeout(function(){n.remove()},400))})},e.prototype.remove=function(){t.prototype.remove.call(this),Utils.each(this.items,function(t){t.remove()})},e.defaults={style:"list"},e}(BaseView),DetailsView=function(t){function e(e){e=e||{},t.prototype.constructor.call(this,e),this.options=e,this.template=this.options.template||detailsTemplate}return Inherits(e,t),Utils.extend(e.prototype,{render:function(){var t=this.model?this.model.toJSON():{path:null,size:null,mime:null};return console.log(t),this.$el.html(this.template(t)),this}}),e}(BaseView),ManagerView=function(t){function e(e){e=e||{},t.prototype.constructor.call(this,e),this.options=e,this.collection=new MediaCollection({url:"files"}),this.template=this.options.template||viewTemplate,this.listView=new ListView({collection:this.collection});var n=this;this.detailsView=new DetailsView({}),this.listView.on("select",function(t){n.detailsView.model=t,n.detailsView.render()})}return Inherits(e,t),Utils.extend(e.prototype,{events:{"click .remove-btn":"onItemRemove","click .add-btn":"onItemAdd"},render:function(){this.$el.html(this.template({}));var t=this.$(".fm-list-container");t.append(this.listView.render().el);var e=this.$(".fm-details-container");return e.append(this.detailsView.render().el),this.delegateEvents(),this},onItemRemove:function(){this.collection.remove(this.listView.selected.model)},onItemAdd:function(){},remove:function(){t.prototype.remove.call(this),this.listView.remove()}}),e}(BaseView);return Resource.UploadButton=UploadButton,Resource.ListView=ListView,Resource.ManagerView=ManagerView,Resource});